extends layout

block content
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title Resultados de Distribuciones Discretas
    link(rel="icon", type="image/png", href="/img/favicon-chart.png")
    link(rel="stylesheet", href="/css/resultados.css")
    link(href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css", rel="stylesheet")
    script(src='https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js')
    script(src='https://cdn.jsdelivr.net/npm/html2canvas@1.3.2/dist/html2canvas.min.js')
    script(src='https://cdn.jsdelivr.net/npm/jspdf@2.3.1/dist/jspdf.umd.min.js')
    script(src='https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js')

  body
    .container-resultados
      .header
      .results
        if tipocalculo == '1'
          h2 Distribución Binomial
          p Número de ensayos (n): #{parametro_principal}
          p Número de éxitos (k): #{parametro_secundario}
          p Probabilidad de éxito (p): #{parametro_terciario}
          p Resultado: #{resultado}
          #chart(style="width: 500px; height: 400px;")
        else if tipocalculo == '2'
          h2 Distribución de Poisson
          p Tasa de éxito (λ): #{parametro_principal}
          p Número de ocurrencias (k): #{parametro_secundario}
          p Resultado: #{resultado}
          #chart(style="width: 500px; height: 400px;")
        else if tipocalculo == '3'
          h2 Distribución Geométrica
          p Probabilidad de éxito (p): #{parametro_principal}
          p Número de ensayos hasta el primer éxito (k): #{parametro_secundario}
          p Resultado: #{resultado}
          #chart(style="width: 500px; height: 400px;")
        else if tipocalculo == '4'
          h2 Distribución Hipergeométrica
          p Tamaño de la población (N): #{parametro_principal}
          p Número de éxitos en la población (K): #{parametro_secundario}
          p Tamaño de la muestra (n): #{parametro_terciario}
          p Número de éxitos en la muestra (k): #{parametro_cuaternario}
          p Resultado: #{resultado}
          #chart(style="width: 500px; height: 400px;")
        else if tipocalculo == '5'
          h2 Distribución de Bernoulli
          p Probabilidad de éxito (p): #{parametro_principal}
          p Valor de la variable (x): #{parametro_secundario}
          p Resultado: #{resultado}
          #chart(style="width: 500px; height: 400px;")
        

      .buttons
        a.btn(href='/dist-disc')
            i.ri-arrow-left-line
            |  Volver
        button.export-btn(onclick='toggleExportOptions()')
            i.ri-file-download-line
            |  Exportar
        .export-buttons.hidden
            button.export-btn(onclick='exportToPDF()')
                i.ri-file-pdf-line
                |  PDF
            button.export-btn(onclick='exportToPNG()')
                i.ri-image-line
                |  PNG
            button.export-btn(onclick='exportToCSV()')
                i.ri-file-excel-line
                |  CSV


  script.
    document.addEventListener('DOMContentLoaded', function () {
      var chart = echarts.init(document.getElementById('chart'));
      var option;

      switch(#{tipocalculo}) {
        case 1:
          option = {
            title: { text: 'Distribución Binomial' },
            tooltip: {},
            xAxis: { type: 'category', data: ['k'] },
            yAxis: { type: 'value' },
            series: [{ type: 'bar', data: [#{resultado}] }]
          };
          break;
        case 2:
          option = {
            title: { text: 'Distribución de Poisson' },
            tooltip: {},
            xAxis: { type: 'category', data: ['k'] },
            yAxis: { type: 'value' },
            series: [{ type: 'bar', data: [#{resultado}] }]
          };
          break;
        case 3:
          option = {
            title: { text: 'Distribución Geométrica' },
            tooltip: {},
            xAxis: { type: 'category', data: ['k'] },
            yAxis: { type: 'value' },
            series: [{ type: 'bar', data: [#{resultado}] }]
          };
          break;
        case 4:
          option = {
            title: { text: 'Distribución Hipergeométrica' },
            tooltip: {},
            xAxis: { type: 'category', data: ['k'] },
            yAxis: { type: 'value' },
            series: [{ type: 'bar', data: [#{resultado}] }]
          };
          break;
        case 5:
          option = {
            title: { text: 'Distribución de Bernoulli' },
            tooltip: {},
            xAxis: { type: 'category', data: ['x'] },
            yAxis: { type: 'value' },
            series: [{ type: 'bar', data: [#{resultado}] }]
          };
          break;
      }
      chart.setOption(option);

      window.exportToPDF = function () {
        html2canvas(document.querySelector('.results')).then(canvas => {
          var imgData = canvas.toDataURL('image/png');
          var pdf = new jspdf.jsPDF();
          pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
          pdf.save('resultado.pdf');
        });
      }

      window.exportToPNG = function () {
        html2canvas(document.querySelector('.results')).then(canvas => {
          canvas.toBlob(blob => {
            saveAs(blob, 'resultado.png');
          });
        });
      }

      window.exportToCSV = function () {
        var csvContent = 'data:text/csv;charset=utf-8,';
        var datos = document.querySelector('.results').innerText;
        csvContent += 'Datos de la Operación\n' + datos + '\n\n';
        csvContent += 'Resultado de la Operación\n' + datos + '\n';

        var encodedUri = encodeURI(csvContent);
        var link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'resultado.csv');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      window.toggleExportOptions = function () {
        document.querySelector('.export-buttons').classList.toggle('hidden');
      }
    });
